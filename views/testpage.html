<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Trip Info</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="/js/copy.js"></script>
</head>

<body>
    <div class="container" style="height: 100vh;">
        <div class="row align-items-center justify-content-center" style="height: 100vh;">
            <div class="col-auto align-self-center">
                <div class="card " style="max-width: 26rem;">
                    <div class="card-body">
                        <textarea hidden class="summaryTaxtarea">rrrrr</textarea>
                        <form id="book" class="g-3 needs-validation" novalidate>
                            <div class="row">
                                <div class="col mb-3">
                                    <div class="form-floating">
                                        <select class="form-select" id="cartype" aria-label="Car type">
                                            <!-- <option value="15" selected>Sedan - Camry 4 Seat</option>
                                            <option value="20">MiniVan - Sienna 7 Seat</option> -->
                                        </select>
                                        <label for="cartype">Car type</label>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-12 mb-3">
                                    <div class="input-group">
                                        <div class="form-floating">
                                            <input type="address" autocomplete="address-line1" class="form-control"
                                                id="address" name="address" required>
                                            <label for="address" class="form-label">pickup address</label>
                                        </div>
                                        <button type="button" onclick="getlocation()"
                                            class="btn btn-outline-secondary"><svg xmlns="http://www.w3.org/2000/svg"
                                                width="16" height="16" fill="currentColor" class="bi bi-crosshair"
                                                viewBox="0 0 16 16">
                                                <path
                                                    d="M8.5.5a.5.5 0 0 0-1 0v.518A7 7 0 0 0 1.018 7.5H.5a.5.5 0 0 0 0 1h.518A7 7 0 0 0 7.5 14.982v.518a.5.5 0 0 0 1 0v-.518A7 7 0 0 0 14.982 8.5h.518a.5.5 0 0 0 0-1h-.518A7 7 0 0 0 8.5 1.018zm-6.48 7A6 6 0 0 1 7.5 2.02v.48a.5.5 0 0 0 1 0v-.48a6 6 0 0 1 5.48 5.48h-.48a.5.5 0 0 0 0 1h.48a6 6 0 0 1-5.48 5.48v-.48a.5.5 0 0 0-1 0v.48A6 6 0 0 1 2.02 8.5h.48a.5.5 0 0 0 0-1zM8 10a2 2 0 1 0 0-4 2 2 0 0 0 0 4" />
                                            </svg></button>
                                        <button class="btn btn-outline-secondary dropdown-toggle" type="button"
                                            data-bs-toggle="dropdown" aria-expanded="false">AP</button>
                                        <ul class="dropdown-menu">
                                            <li><button type="button" class="dropdown-item"
                                                    onclick="ulclick_departure(this)">SEATAC</button></li>
                                            <li><button type="button" class="dropdown-item"
                                                    onclick="ulclick_departure(this)">PAE</button></li>
                                        </ul>
                                    </div>

                                </div>
                                <div class="col-12 mb-3" hidden>
                                    <div class="form-floating">
                                        <input name="googleaddress" type="address" class="form-control"
                                            id="googleaddress" name="googleaddress" readonly required>
                                        <label for="googleaddress" class="form-label">Address(google)</label>
                                    </div>
                                </div>
                            </div>
                            <div class="row justify-content-end">
                                <div class="col-auto mb-3"><button type="button" class="btn btn-outline-dark"
                                        onclick="switch_address()">switch</button>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-12 mb-3 ">
                                    <div class="input-group">
                                        <div class="form-floating">
                                            <input type="address" class="form-control" id="destination_address"
                                                name="destination_address" required>
                                            <label for="destination_address" autocomplete="address-line1"
                                                class="form-label">destination
                                                address</label>
                                        </div>
                                        <button class="btn btn-outline-secondary dropdown-toggle" type="button"
                                            data-bs-toggle="dropdown" aria-expanded="false">AP</button>
                                        <ul class="dropdown-menu">
                                            <li><button type="button" class="dropdown-item"
                                                    onclick="ulclick_destination(this)">SEATAC</button></li>
                                            <li><button type="button" class="dropdown-item"
                                                    onclick="ulclick_destination(this)">PAE</button></li>
                                        </ul>
                                    </div>

                                </div>
                                <div class="col-12 mb-3" hidden>
                                    <div class="form-floating">
                                        <input type="address" class="form-control" id="googledestination"
                                            name="googledestination" readonly required>
                                        <label for="googledestination" class="form-label">destination
                                            address(google)</label>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col mb-3 d-grid gap-2"><button type="submit"
                                        class="btn btn-primary">Calculate</button>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-3 mb-3">
                                    <div class="form-floating">
                                        <input type="number" class="form-control" id="distance" value="0"
                                            name="distance">
                                        <label for="distance" class="form-label">Distance</label>
                                    </div>
                                </div>
                                <div class="col mb-3">
                                    <div class="form-floating">
                                        <input type="number" class="form-control" id="pickup_distance" value="0"
                                            name="pickup_distance">
                                        <label for="pickup_distance" class="form-label">
                                            pickup distance</label>
                                    </div>
                                </div>
                                <div class="col-3 mb-3">
                                    <div class="form-floating">
                                        <input type="text" class="form-control" id="price" name="price" value="0">
                                        <label for="price" class="form-label">Price</label>
                                    </div>
                                </div>
                            </div>
                            <div class="row text-end">
                                <div class="col">
                                    <div class="row">
                                        <div class="col">
                                            <div>
                                                #
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col">
                                            <div>
                                                pickup:
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col">
                                            <div>
                                                distance:
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row ">
                                        <div class="col">
                                            <div>
                                                base:
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col">
                                            <div>
                                                total:
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-auto px-0 text-center">
                                    <div class="row">
                                        <div class="col">Unit</div>
                                    </div>
                                    <div class="row">
                                        <div class="col">
                                            <div id="label_pickup_1"></div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col">
                                            <div id="label_dropoff_1"></div>
                                        </div>
                                    </div>
                                    <div class="row border-bottom border-black">
                                        <div class="col">
                                            <div id="label_base_1"></div>
                                        </div>


                                    </div>
                                    <div class="row">
                                        <div class="col"></div>


                                    </div>
                                </div>
                                <div class="col-auto px-0 text-center">
                                    <div class="row">
                                        <div class="col">-</div>
                                    </div>
                                    <div class="row">
                                        <div class="col">*</div>

                                    </div>
                                    <div class="row">
                                        <div class="col">*</div>

                                    </div>
                                    <div class="row ">
                                        <div class="col">*</div>

                                    </div>
                                    <div class="row">
                                    </div>
                                </div>
                                <div class="col-auto px-0 text-center">
                                    <div class="row">
                                        <div class="col">price</div>

                                    </div>
                                    <div class="row">
                                        <div class="col">
                                            <div id="label_pickup_2"></div>
                                        </div>

                                    </div>
                                    <div class="row">
                                        <div class="col">
                                            <div id="label_dropoff_2"></div>
                                        </div>

                                    </div>
                                    <div class="row border-bottom border-black">
                                        <div class="col">1</div>

                                    </div>
                                    <div class="row">
                                        <div class="col"></div>

                                    </div>
                                </div>
                                <div class="col-auto px-0 text-center">
                                    <div class="row">
                                        <div class="col-1">. </div>
                                    </div>
                                    <div class="row">
                                        <div class="col">=</div>
                                    </div>
                                    <div class="row">
                                        <div class="col">=</div>
                                    </div>
                                    <div class="row border-bottom border-black">
                                        <div class="col">=</div>
                                    </div>
                                    <div class="row">
                                        <div class="col"></div>
                                    </div>
                                </div>
                                <div class="col-auto" ps-0 text-center>
                                    <div class="row">
                                        <div class="col">
                                            Tot:
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="col">
                                            <div id="label_pickup_t">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col">
                                            <div id="label_dropoff_t">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row border-bottom border-black">
                                        <div class="col">
                                            <div id="label_base_t">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row ">
                                        <div class="col">
                                            <div id="label_total_t">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        (() => {
            'use strict'

            // Fetch all the forms we want to apply custom Bootstrap validation styles to
            const forms = document.querySelectorAll('.needs-validation')

            // Loop over them and prevent submission
            Array.from(forms).forEach(form => {
                form.addEventListener('submit', event => {
                    if (!form.checkValidity()) {
                        event.preventDefault()
                        event.stopPropagation()
                    } else {
                        event.preventDefault();
                        get_dis();
                    }
                    form.classList.add('was-validated')
                }, false)
            })
        })()


        var googleaddress = $('#googleaddress')
        var distance = $('#distance')
        var departure_address = $('#address')
        var pickup_distance = $('#pickup_distance')
        var googledestination = $('#googledestination')
        var destination_address = $('#destination_address')
        var cartype = $('#cartype')
        var price = $('#price')
        var basic_price = 15;
        var pickup_distance_free = 6
        var dis_price = 1.75
        var pickup_distance_price = 0.5

        var label_pickup_1 = $('#label_pickup_1')
        var label_pickup_2 = $('#label_pickup_2')

        var label_distance_1 = $('#label_dropoff_1')
        var label_distance_2 = $('#label_dropoff_2')

        var label_base_1 = $('#label_base_1')
        var label_base_2 = $('#label_base_2')

        var label_total = $('#label_total')
        var label_pickup_t = $('#label_pickup_t')
        var label_distance_t = $('#label_dropoff_t')
        var label_base_t = $('#label_base_t')
        var label_total_t = $('#label_total_t')

        var car = [];
        $(document).ready(() => {
            $.get('/api_trips_get_car_info', (data) => {

                data.car.forEach(e => {
                    e.model = data.basic.car_model[e.model];
                    e.made = data.basic.car_made[e.model.car_made_id];
                    e.type = data.basic.car_type[e.model.car_type];
                    cartype.append($('<option>', { value: e.price, text: e.model.model_name + ' - ' + e.model.seat + ' seat' }));
                })
                distance.keyup(getprice);
                pickup_distance.keyup(getprice);
                cartype.change(getprice);
                cartype.val(data.car[0].price.toString()).change();
                console.log(data);

            })
        })

        var getlocation = () => {
            departure_address.addClass('disabled placeholder')
            navigator.geolocation.getCurrentPosition((pos) => {
                //alert(pos.coords.latitude + ',' + pos.coords.longitude);
                departure_address.val(pos.coords.latitude + ',' + pos.coords.longitude)
                console.log(pos)
                departure_address.removeClass('disabled placeholder')
            })
        }

        var getprice = () => {
            var _total = 0;
            var pickup_total = pickup_distance.val() - pickup_distance_free
            _total = basic_price + dis_price * distance.val() + (pickup_total > 0 ? pickup_total : 0) * pickup_distance_price + parseInt(cartype.val());
            price.val(_total)
            showdetial()
        }

        var showdetial = () => {
            label_pickup_1.text('(' + pickup_distance.val() + '-' + pickup_distance_free + ')');
            label_pickup_2.text(pickup_distance_price);

            label_distance_1.text(distance.val());
            label_distance_2.text(dis_price);

            label_base_1.text(basic_price + parseInt(cartype.val()))

            label_distance_t.text(dis_price * distance.val())
            label_pickup_t.text((pickup_distance.val() - pickup_distance_free > 0 ? pickup_distance.val() - pickup_distance_free : 0) * pickup_distance_price)
            label_base_t.text(cartype.val())
            label_total_t.text(price.val())
        }
        showdetial()



        var ulclick_destination = (e) => {
            console.log(e.firstChild.data)
            if (e.firstChild.data === 'SEA') {
                destination_address.val('17801 International Blvd, Seattle, WA 98158')
            } else {
                destination_address.val('3220 100th St SW, Everett, WA 98204')
            }
        }
        var ulclick_departure = (e) => {
            console.log(e.firstChild.data)
            if (e.firstChild.data === 'SEA') {
                departure_address.val('17801 International Blvd, Seattle, WA 98158')
            } else {
                departure_address.val('3220 100th St SW, Everett, WA 98204')
            }
        }




        function get_dis() {
            axios.get('/api_trips_get_price', { params: { start: departure_address.val(), end: destination_address.val(), type: 0 } }).then((res) => {
                if (typeof res.data === 'string') {
                    return alert(res.data);
                }
                googleaddress.val(res.data.address1.address)
                distance.val(res.data.dropoff_dis);
                departure_address.val(res.data.address1.address);
                pickup_distance.val(res.data.pickup_dis)
                googledestination.val(res.data.address2.address)
                destination_address.val(res.data.address2.address)
                getprice();
            })
        }

        var switch_address = () => {
            var a = departure_address.val();
            var b = googleaddress.val();
            departure_address.val(destination_address.val())
            googleaddress.val(googledestination.val())
            destination_address.val(a);
            googledestination.val(b)
        }

    </script>
</body>

</html>